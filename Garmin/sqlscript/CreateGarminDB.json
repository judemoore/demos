{
	"name": "CreateGarminDB",
	"properties": {
		"description": "Create GarminFiles DB and view for the activites data",
		"content": {
			"query": "USE MASTER\nGO\n\n-- Drop database if it exists\nDROP DATABASE IF EXISTS GarminFiles\nGO\n\n-- Create new database\nCREATE DATABASE [GarminFiles]\nGO\n\nUSE GarminFiles\nGO\n\n\n-- There is no credential in data surce. We are using public storage account which doesn't need a secret.\nCREATE EXTERNAL DATA SOURCE MyGarminPQfiles\nWITH ( LOCATION = 'https://personalprojectsrslake.dfs.core.windows.net/')\nGO\n\nDROP VIEW IF EXISTS vwGarminActivity\nGO\n\nCREATE VIEW vwGarminActivity AS\nSELECT *\nFROM\n    OPENROWSET\n        (\n        BULK '/personalprojectsfs/synapse/workspaces/personalprojectsrgsynapse/DataFiles/Garmin/garmin_get_activities_by_date-2*.parquet',\n        DATA_SOURCE = 'MyGarminPQfiles',\n        FORMAT='PARQUET'\n        )\n        WITH\n            (\n                [activityId] VARCHAR (4000),\n                [activityName] VARCHAR (4000),\n                [startTimeLocal] VARCHAR (4000),\n                [startTimeGMT] VARCHAR (4000),\n                [distance] VARCHAR (4000),\n                [duration] VARCHAR (4000),\n                [elapsedDuration] VARCHAR (4000),\n                [movingDuration] VARCHAR (4000),\n                [averageSpeed] VARCHAR (4000),\n                [hasPolyline] VARCHAR (4000),\n                [hasImages] VARCHAR (4000),\n                [ownerId] VARCHAR (4000),\n                [ownerDisplayName] VARCHAR (4000),\n                [ownerFullName] VARCHAR (4000),\n                [ownerProfileImageUrlSmall] VARCHAR (4000),\n                [ownerProfileImageUrlMedium] VARCHAR (4000),\n                [ownerProfileImageUrlLarge] VARCHAR (4000),\n                [calories] VARCHAR (4000),\n                [bmrCalories] VARCHAR (4000),\n                [averageHR] VARCHAR (4000),\n                [maxHR] VARCHAR (4000),\n                [steps] VARCHAR (4000),\n                [userRoles] VARCHAR (4000),\n                [userPro] VARCHAR (4000),\n                [hasVideo] VARCHAR (4000),\n                [timeZoneId] VARCHAR (4000),\n                [beginTimestamp] VARCHAR (4000),\n                [sportTypeId] VARCHAR (4000),\n                [deviceId] VARCHAR (4000),\n                [summarizedExerciseSets] VARCHAR (4000),\n                [manufacturer] VARCHAR (4000),\n                [lapCount] VARCHAR (4000),\n                [waterEstimated] VARCHAR (4000),\n                [totalSets] VARCHAR (4000),\n                [activeSets] VARCHAR (4000),\n                [totalReps] VARCHAR (4000),\n                [minActivityLapDuration] VARCHAR (4000),\n                [splitSummaries] VARCHAR (4000),\n                [hasSplits] VARCHAR (4000),\n                [moderateIntensityMinutes] VARCHAR (4000),\n                [vigorousIntensityMinutes] VARCHAR (4000),\n                [differenceBodyBattery] VARCHAR (4000),\n                [pr] VARCHAR (4000),\n                [autoCalcCalories] VARCHAR (4000),\n                [elevationCorrected] VARCHAR (4000),\n                [atpActivity] VARCHAR (4000),\n                [favorite] VARCHAR (4000),\n                [decoDive] VARCHAR (4000),\n                [parent] VARCHAR (4000),\n                [purposeful] VARCHAR (4000),\n                [manualActivity] VARCHAR (4000),\n                [activityType.typeId] VARCHAR (4000),\n                [activityType.typeKey] VARCHAR (4000),\n                [activityType.parentTypeId] VARCHAR (4000),\n                [activityType.isHidden] VARCHAR (4000),\n                [activityType.restricted] VARCHAR (4000),\n                [activityType.trimmable] VARCHAR (4000),\n                [eventType.typeId] VARCHAR (4000),\n                [eventType.typeKey] VARCHAR (4000),\n                [eventType.sortOrder] VARCHAR (4000),\n                [privacy.typeId] VARCHAR (4000),\n                [privacy.typeKey] VARCHAR (4000),\n                [summarizedDiveInfo.summarizedDiveGases] VARCHAR (4000),\n                [elevationGain] VARCHAR (4000),\n                [elevationLoss] VARCHAR (4000),\n                [maxSpeed] VARCHAR (4000),\n                [startLatitude] VARCHAR (4000),\n                [startLongitude] VARCHAR (4000),\n                [averageRunningCadenceInStepsPerMinute] VARCHAR (4000),\n                [maxRunningCadenceInStepsPerMinute] VARCHAR (4000),\n                [avgStrideLength] VARCHAR (4000),\n                [minElevation] VARCHAR (4000),\n                [maxElevation] VARCHAR (4000),\n                [maxDoubleCadence] VARCHAR (4000),\n                [maxVerticalSpeed] VARCHAR (4000),\n                [locationName] VARCHAR (4000),\n                [endLatitude] VARCHAR (4000),\n                [endLongitude] VARCHAR (4000),\n                [vO2MaxValue] VARCHAR (4000)\n            )\n         AS uspv;\n\n\n-- Test\n-- select * from vwGarminActivity",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "GarminFiles",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}